{"type":"entity","entityType":"database_migration","name":"approximate_exercise_archetype_mapping","observations":["SQL migration to populate exercises.archetype_id based on keyword matching."],"createdAt":"2025-05-15T07:25:13.604Z","version":1}
{"type":"entity","name":"approximate_exercise_muscle_group_mapping_fix","entityType":"database_migration","observations":["SQL migration to populate public.exercise_muscle_groups for non-Isolation exercises based on archetype_muscle_map."],"createdAt":"2025-05-15T07:25:13.613Z","version":1}
{"type":"entity","observations":["Approximated data population attempted via SQL."],"entityType":"database_table_column","name":"exercises.archetype_id","createdAt":"2025-05-15T07:25:13.613Z","version":1}
{"type":"entity","observations":["Approximated data population attempted via SQL for non-Isolation exercises.","Attempted to populate with specific muscle mappings for Isolation exercises via SQL migration map_isolation_exercises_to_muscles_v2."],"name":"public.exercise_muscle_groups","entityType":"database_table","createdAt":"2025-05-15T07:25:13.613Z","version":1}
{"type":"entity","observations":["SQL migration to populate exercise_muscle_groups for Isolation exercises by matching exercise names to specific muscle_definitions using keywords."],"entityType":"database_migration","name":"map_isolation_exercises_to_muscles_v2","createdAt":"2025-05-15T07:36:43.468Z","version":1}
{"type":"entity","name":"Muscle Group Overhaul Plan","entityType":"project_plan","observations":["Overall plan updated to reflect current status as of assistant's last message.","Phase 1 (DB Schema): Largely Complete.","Phase 1.5 (Data Population): Assistant scripts deployed for approximation; User review and refinement script is critical next step.","Phase 2 (App Code): TS types updated. RPCs partially updated. Volume.tsx refactor ongoing, blocked by linter.","Key pending items: User data refinement, RPC finalization, RLS policies, Volume.tsx fix, testing."],"createdAt":"2025-05-15T07:39:38.695Z","version":1}
{"type":"entity","entityType":"database_function","observations":["SQL function to fetch weekly exercise sets per muscle group and archetype for a user.","SELECT\\n    trim(split_part(ma.name, \\'(\\', 1)) AS calculated_base_archetype_name,\\n    CASE\\n        WHEN ma.name LIKE \\'%(\\%)\\%\\' THEN\\n            trim(regexp_replace(regexp_substr(ma.name, \\'\\\\\\\\(\\'.*?\\\\\\\\)\\'), \\'[()]\\', \\'\\', \\'g\\'))\\n        ELSE\\n            NULL\\n    END AS calculated_archetype_subtype_name,\\n    md.name AS muscle_name,\\n    COUNT(es.id) AS sets_count\\nFROM\\n    public.exercise_sets es\\nJOIN\\n    public.workout_exercises we ON es.workout_exercise_id = we.id\\nJOIN\\n    public.workouts w ON we.workout_id = w.id\\nJOIN\\n    public.exercises ex ON we.exercise_id = ex.id\\nJOIN -- Changed from1 LEFT JOIN to JOIN: an exercise must have an archetype to contribute to this volume calculation\\n    public.movement_archetypes ma ON ex.archetype_id = ma.id\\nJOIN -- An exercise must be mapped to specific muscles to be included\\n    public.exercise_muscle_groups emg ON ex.id = emg.exercise_id\\nJOIN\\n    public.muscle_definitions md ON emg.muscle_definition_id = md.id\\nWHERE\\n    w.user_id = p_user_id\\n    AND w.completed = TRUE\\n    AND es.completed = TRUE -- Count only completed sets for volume\\n    AND w.created_at >= (CURRENT_DATE - INTERVAL \\'7 days\\') -- Calculate for the last 7 days\\n    -- AND ex.archetype_id IS NOT NULL -- This is implicitly handled by the JOIN to movement_archetypes\\nGROUP BY\\n    calculated_base_archetype_name,\\n    calculated_archetype_subtype_name,\\n    muscle_name;"],"name":"fetch_weekly_sets_per_muscle_group_rpc","createdAt":"2025-05-15T08:07:01.019Z","version":1}
{"type":"entity","entityType":"best_practice","name":"RLS Policy Creation for New Tables","observations":["Always consider and typically add Row Level Security (RLS) policies when creating new database tables, especially if they are involved in RPCs or queries that will be executed under an authenticated user's context.","Missing RLS policies (e.g., for SELECT on a table like 'movement_archetypes') can cause RPCs to return empty results from the client even if direct SQL queries work in the editor with higher privileges."],"createdAt":"2025-05-15T08:26:35.679Z","version":1}
{"type":"entity","observations":["Refactored Analytics.tsx to use a Card with Tabs for E1RM, Volume, and Benchmarks.","Performance Overview is above the card, RecentWorkouts is below.","Removed internal Card wrappers from OneRepMax.tsx, Volume.tsx, StrengthBenchmarks.tsx, and CalisthenicBenchmarks.tsx to resolve card-in-card issue.","These components now render their content directly within the main TabsContent on Analytics.tsx, with adjusted padding for consistency."],"entityType":"ui_component_group","name":"AnalyticsPageUI","createdAt":"2025-05-15T08:36:34.652Z","version":1}
{"type":"entity","entityType":"database_migration","name":"approximate_exercise_archetype_mapping","observations":["SQL migration to populate exercises.archetype_id based on keyword matching."],"createdAt":"2025-05-15T07:25:13.604Z","version":1}
{"type":"entity","name":"approximate_exercise_muscle_group_mapping_fix","entityType":"database_migration","observations":["SQL migration to populate public.exercise_muscle_groups for non-Isolation exercises based on archetype_muscle_map."],"createdAt":"2025-05-15T07:25:13.613Z","version":1}
{"type":"entity","observations":["Approximated data population attempted via SQL."],"entityType":"database_table_column","name":"exercises.archetype_id","createdAt":"2025-05-15T07:25:13.613Z","version":1}
{"type":"entity","observations":["Approximated data population attempted via SQL for non-Isolation exercises.","Attempted to populate with specific muscle mappings for Isolation exercises via SQL migration map_isolation_exercises_to_muscles_v2."],"name":"public.exercise_muscle_groups","entityType":"database_table","createdAt":"2025-05-15T07:25:13.613Z","version":1}
{"type":"entity","observations":["SQL migration to populate exercise_muscle_groups for Isolation exercises by matching exercise names to specific muscle_definitions using keywords."],"entityType":"database_migration","name":"map_isolation_exercises_to_muscles_v2","createdAt":"2025-05-15T07:36:43.468Z","version":1}
{"type":"entity","name":"Muscle Group Overhaul Plan","entityType":"project_plan","observations":["Overall plan updated to reflect current status as of assistant's last message.","Phase 1 (DB Schema): Largely Complete.","Phase 1.5 (Data Population): Assistant scripts deployed for approximation; User review and refinement script is critical next step.","Phase 2 (App Code): TS types updated. RPCs partially updated. Volume.tsx refactor ongoing, blocked by linter.","Key pending items: User data refinement, RPC finalization, RLS policies, Volume.tsx fix, testing."],"createdAt":"2025-05-15T07:39:38.695Z","version":1}
{"type":"entity","entityType":"database_function","observations":["SQL function to fetch weekly exercise sets per muscle group and archetype for a user.","SELECT\\n    trim(split_part(ma.name, \\'(\\', 1)) AS calculated_base_archetype_name,\\n    CASE\\n        WHEN ma.name LIKE \\'%(\\%)\\%\\' THEN\\n            trim(regexp_replace(regexp_substr(ma.name, \\'\\\\\\\\(\\'.*?\\\\\\\\)\\'), \\'[()]\\', \\'\\', \\'g\\'))\\n        ELSE\\n            NULL\\n    END AS calculated_archetype_subtype_name,\\n    md.name AS muscle_name,\\n    COUNT(es.id) AS sets_count\\nFROM\\n    public.exercise_sets es\\nJOIN\\n    public.workout_exercises we ON es.workout_exercise_id = we.id\\nJOIN\\n    public.workouts w ON we.workout_id = w.id\\nJOIN\\n    public.exercises ex ON we.exercise_id = ex.id\\nJOIN -- Changed from1 LEFT JOIN to JOIN: an exercise must have an archetype to contribute to this volume calculation\\n    public.movement_archetypes ma ON ex.archetype_id = ma.id\\nJOIN -- An exercise must be mapped to specific muscles to be included\\n    public.exercise_muscle_groups emg ON ex.id = emg.exercise_id\\nJOIN\\n    public.muscle_definitions md ON emg.muscle_definition_id = md.id\\nWHERE\\n    w.user_id = p_user_id\\n    AND w.completed = TRUE\\n    AND es.completed = TRUE -- Count only completed sets for volume\\n    AND w.created_at >= (CURRENT_DATE - INTERVAL \\'7 days\\') -- Calculate for the last 7 days\\n    -- AND ex.archetype_id IS NOT NULL -- This is implicitly handled by the JOIN to movement_archetypes\\nGROUP BY\\n    calculated_base_archetype_name,\\n    calculated_archetype_subtype_name,\\n    muscle_name;"],"name":"fetch_weekly_sets_per_muscle_group_rpc","createdAt":"2025-05-15T08:07:01.019Z","version":1}
{"type":"entity","entityType":"best_practice","name":"RLS Policy Creation for New Tables","observations":["Always consider and typically add Row Level Security (RLS) policies when creating new database tables, especially if they are involved in RPCs or queries that will be executed under an authenticated user's context.","Missing RLS policies (e.g., for SELECT on a table like 'movement_archetypes') can cause RPCs to return empty results from the client even if direct SQL queries work in the editor with higher privileges."],"createdAt":"2025-05-15T08:26:35.679Z","version":1}
{"type":"entity","observations":["Refactored Analytics.tsx to use Tabs for E1RM, Volume, and Benchmarks, removing the main Card wrapper.","Performance Overview is above the tabs, RecentWorkouts is below.","Removed internal Card wrappers from1 OneRepMax.tsx, Volume.tsx, StrengthBenchmarks.tsx, and CalisthenicBenchmarks.tsx to resolve card-in-card issue.","These components now render their content directly within the main TabsContent on Analytics.tsx, with adjusted padding for consistency."],"entityType":"ui_component_group","name":"AnalyticsPageUI","createdAt":"2025-05-15T12:36:59.531Z","version":2}
{"type":"entity","name":"Timed Exercises","entityType":"feature","observations":["Implemented support for timed (static) exercises alongside rep-based exercises."],"createdAt":"2025-05-15T10:18:46.136Z","version":1}
{"type":"entity","name":"exercises.is_static","entityType":"database_table_column","observations":["Boolean column, TRUE if exercise is timed, FALSE/NULL if rep-based. Determines UI for logging sets."],"createdAt":"2025-05-15T10:18:46.136Z","version":1}
{"type":"entity","observations":["Integer column, stores duration in seconds for a timed set. Null if set is rep-based."],"entityType":"database_table_column","name":"exercise_sets.time_seconds","createdAt":"2025-05-15T10:18:46.136Z","version":1}
{"type":"entity","entityType":"database_table_column","name":"exercise_sets.reps","observations":["Integer column, stores repetitions for a rep-based set. Now nullable; null if set is timed."],"createdAt":"2025-05-15T10:18:46.136Z","version":1}
{"type":"entity","name":"exercise_sets.chk_reps_or_time","observations":["Ensures that for any set, either reps or time_seconds is populated, but not both (one must be NULL)."],"entityType":"database_constraint","createdAt":"2025-05-15T10:18:46.136Z","version":1}
{"type":"entity","observations":["Modified to conditionally show time input for static exercises and save `time_seconds` or `reps` accordingly."],"entityType":"react_component","name":"AddSingleExerciseDialog.tsx","createdAt":"2025-05-15T10:18:46.136Z","version":1}
{"type":"entity","entityType":"react_component","observations":["Table headers now display 'Time' or 'Reps' based on exercise.is_static. Passes is_static to SetComponent."],"name":"WorkoutExerciseView.tsx","createdAt":"2025-05-15T10:18:46.136Z","version":1}
{"type":"entity","observations":["Conditionally renders input for time (seconds) or reps. Dispatches appropriate data (reps or time_seconds) to Redux."],"name":"SetComponent.tsx","entityType":"react_component","createdAt":"2025-05-15T10:18:46.136Z","version":1}
{"type":"entity","entityType":"react_component","observations":["Logic updated to fetch, process, and pass time_seconds for historical performance. Handles updates to last set for both reps and time."],"name":"WorkoutExerciseContainer.tsx","createdAt":"2025-05-15T10:18:46.136Z","version":1}
{"type":"entity","name":"fetchLastWorkoutExerciseInstanceFromDB","observations":["Located in src/lib/integrations/supabase/history.ts. Updated to select and return time_seconds from1 exercise_sets."],"entityType":"typescript_function","createdAt":"2025-05-15T10:18:46.136Z","version":1}
{"type":"entity","entityType":"redux_slice","name":"workoutSlice.ts","observations":["`addSetToExercise` action now accepts `isStatic` to initialize sets. `updateSet` action handles `time_seconds` and nullable `reps`."],"createdAt":"2025-05-15T10:18:46.136Z","version":1}
{"type":"entity","entityType":"typescript_function","observations":["Located in src/lib/integrations/supabase/exercises.ts. Updated to accept and store `is_static` flag for new exercises."],"name":"createExerciseInDB","createdAt":"2025-05-15T10:18:46.136Z","version":1}
{"type":"entity","name":"ExerciseSelector.tsx","entityType":"component_file","observations":["Modified the \"add new exercise\" dialog to include a toggle for \"Timed\" (is_static).","Repositioned \"Add\" and \"Cancel\" buttons in the \"add new exercise\" dialog.","Ensured `is_static` flag is passed to `createExerciseInDB` and `addSetToExercise` when a new exercise is created."],"createdAt":"2025-05-15T10:22:14.230Z","version":1}
{"type":"entity","observations":["Modified to support different goal sets for different movement archetypes.","GOAL_SETS constant changed from a single number to an object mapping archetype names to numbers.","UI and logic updated to reflect individual goals for Squat (7), Lunge (7), Bend (7), Push (10), Pull (10), and Twist (7)."],"entityType":"react_component","name":"Volume.tsx","createdAt":"2025-05-15T19:04:52.340Z","version":2}
{"type":"entity","entityType":"react_component_file","name":"RecentWorkouts.tsx","observations":["Modified to display a dialog with detailed workout information (exercises and their completed sets) when a workout card is clicked. Uses `fetchDetailedWorkoutById` to retrieve this data. Manages state for dialog visibility and selected workout ID."],"createdAt":"2025-05-16T06:48:50.956Z","version":1}
{"type":"entity","entityType":"typescript_function","name":"fetchDetailedWorkoutById","observations":["Located in `src/lib/integrations/supabase/history.ts`. Fetches all exercises (name, order) and their sets (set_number, reps, weight, time_seconds, completed) for a given `workoutId` and `userId`. Returns a `DetailedWorkout` object or null."],"createdAt":"2025-05-16T06:48:50.956Z","version":1}
{"type":"entity","entityType":"typescript_interface","observations":["Represents the detailed structure of a single workout, including `workout_id`, `workout_created_at`, and an array of `WorkoutExerciseDetail`. Defined in `src/lib/integrations/supabase/history.ts`."],"name":"DetailedWorkout","createdAt":"2025-05-16T06:48:50.956Z","version":1}
{"type":"entity","name":"WorkoutExerciseDetail","observations":["Represents an exercise within a detailed workout, including `exercise_id`, `exercise_name`, `order`, an array of `WorkoutSet`, and `completed_sets_count`. Defined in `src/lib/integrations/supabase/history.ts`."],"entityType":"typescript_interface","createdAt":"2025-05-16T06:48:50.956Z","version":1}
{"type":"entity","name":"WorkoutSet","observations":["Represents a single set of an exercise, including `set_number`, `reps`, `weight`, `time_seconds`, and `completed` status. Defined in `src/lib/integrations/supabase/history.ts`."],"entityType":"typescript_interface","createdAt":"2025-05-16T06:48:50.956Z","version":1}
{"type":"entity","name":"Workout Details Dialog","entityType":"ui_feature","observations":["A dialog window within `RecentWorkouts.tsx` that displays detailed set-by-set information for each exercise performed in a selected past workout. Triggered by clicking on a workout card."],"createdAt":"2025-05-16T06:48:50.956Z","version":1}
{"type":"entity","entityType":"supabase_project","name":"Stratos Supabase Project","observations":["Project ID: fhkhpwoxedcytetcjnob","Used for the Stratos application."],"createdAt":"2025-05-16T08:02:38.549Z","version":1}
{"type":"entity","name":"Protein Logging","entityType":"feature","observations":["Allows users to log daily protein intake.","Includes Supabase tables `protein_intake` and `user_metrics`.","FAB in App.tsx updated with 'Log Protein' option.","ProteinLogging.tsx component created for the logging modal.","Supabase client functions for nutrition created in `lib/integrations/supabase/nutrition.ts`."],"createdAt":"2025-05-16T08:04:36.420Z","version":1}
{"type":"entity","entityType":"ui_component","observations":["Located in `src/components/features/Nutrition/ProteinLogging.tsx`.","Form with input for protein amount and submit button.","Calls `addProteinIntake` on submit."],"name":"ProteinLoggingModal","createdAt":"2025-05-16T08:04:36.420Z","version":1}
{"type":"entity","entityType":"ui_component","name":"FloatingActionButton_App.tsx","observations":["Located in `src/App.tsx`.","Modified to include a 'Log Protein' DropdownMenuItem.","Triggers the ProteinLoggingModal."],"createdAt":"2025-05-16T08:04:36.420Z","version":1}
{"type":"entity","entityType":"database_table","name":"protein_intake","observations":["Columns: id, user_id, date, amount_grams, created_at.","Stores individual protein intake records.","RLS policies implemented."],"createdAt":"2025-05-16T08:04:36.420Z","version":1}
{"type":"entity","observations":["Located at `supabase/migrations/add_protein_tracking.sql`.","Contains SQL for creating `protein_intake` and `user_metrics` tables."],"entityType":"file","name":"supabase_migration_add_protein_tracking","createdAt":"2025-05-16T08:04:36.420Z","version":1}
{"type":"entity","name":"supabase_nutrition_client_functions","entityType":"file","observations":["Located at `src/lib/integrations/supabase/nutrition.ts`.","Contains `addProteinIntake`, `getDailyProteinIntake`, `getUserWeight`, `updateUserWeight`."],"createdAt":"2025-05-16T08:04:36.420Z","version":1}
{"type":"entity","observations":["Integrated into `src/pages/Analytics.tsx`.","Displays daily protein intake against a goal (2g/kg body weight).","Uses `ProgressBar.tsx` component.","Fetches data using `getUserWeight` and `getDailyProteinIntake`."],"entityType":"ui_feature","name":"AnalyticsProteinProgress","createdAt":"2025-05-16T08:04:36.420Z","version":1}
{"type":"entity","name":"ProgressBarComponent","observations":["Located in `src/components/core/ProgressBar.tsx`.","Generic progress bar UI component."],"entityType":"ui_component","createdAt":"2025-05-16T08:04:36.420Z","version":1}
{"type":"entity","name":"profiles_table","entityType":"database_table","observations":["Existing Supabase table.","Contains user profile information, including `weight` (used as `weight_kg`).","RLS policies allow users to read/update their own profile.","Contains a 'focus' column to store the user's current training focus (e.g., Strength, Hypertrophy)."],"createdAt":"2025-05-16T08:17:25.438Z","version":1}
{"type":"relation","from":"Timed Exercises","to":"exercises.is_static","relationType":"modifies","createdAt":"2025-05-15T10:18:57.272Z","version":1}
{"type":"relation","relationType":"modifies","from":"Timed Exercises","to":"exercise_sets.time_seconds","createdAt":"2025-05-15T10:18:57.272Z","version":1}
{"type":"relation","relationType":"modifies","from":"Timed Exercises","to":"exercise_sets.reps","createdAt":"2025-05-15T10:18:57.272Z","version":1}
{"type":"relation","from":"Timed Exercises","to":"exercise_sets.chk_reps_or_time","relationType":"adds","createdAt":"2025-05-15T10:18:57.272Z","version":1}
{"type":"relation","to":"AddSingleExerciseDialog.tsx","relationType":"modifies_component","from":"Timed Exercises","createdAt":"2025-05-15T10:18:57.272Z","version":1}
{"type":"relation","relationType":"modifies_component","to":"WorkoutExerciseView.tsx","from":"Timed Exercises","createdAt":"2025-05-15T10:18:57.272Z","version":1}
{"type":"relation","relationType":"modifies_component","from":"Timed Exercises","to":"SetComponent.tsx","createdAt":"2025-05-15T10:18:57.272Z","version":1}
{"type":"relation","relationType":"modifies_component","from":"Timed Exercises","to":"WorkoutExerciseContainer.tsx","createdAt":"2025-05-15T10:18:57.272Z","version":1}
{"type":"relation","to":"fetchLastWorkoutExerciseInstanceFromDB","from":"Timed Exercises","relationType":"modifies_function","createdAt":"2025-05-15T10:18:57.272Z","version":1}
{"type":"relation","relationType":"modifies_slice","from":"Timed Exercises","to":"workoutSlice.ts","createdAt":"2025-05-15T10:18:57.272Z","version":1}
{"type":"relation","relationType":"modifies_function","to":"createExerciseInDB","from":"Timed Exercises","createdAt":"2025-05-15T10:18:57.272Z","version":1}
{"type":"relation","from":"AddSingleExerciseDialog.tsx","relationType":"uses_column","to":"exercises.is_static","createdAt":"2025-05-15T10:18:57.272Z","version":1}
{"type":"relation","from":"AddSingleExerciseDialog.tsx","relationType":"uses_column","to":"exercise_sets.time_seconds","createdAt":"2025-05-15T10:18:57.272Z","version":1}
{"type":"relation","from":"WorkoutExerciseView.tsx","to":"exercises.is_static","relationType":"uses_column","createdAt":"2025-05-15T10:18:57.272Z","version":1}
{"type":"relation","from":"WorkoutExerciseView.tsx","relationType":"uses_component","to":"SetComponent.tsx","createdAt":"2025-05-15T10:18:57.272Z","version":1}
{"type":"relation","from":"SetComponent.tsx","relationType":"uses_column","to":"exercise_sets.time_seconds","createdAt":"2025-05-15T10:18:57.272Z","version":1}
{"type":"relation","relationType":"uses_column","from":"SetComponent.tsx","to":"exercise_sets.reps","createdAt":"2025-05-15T10:18:57.272Z","version":1}
{"type":"relation","from":"SetComponent.tsx","to":"workoutSlice.ts","relationType":"dispatches_to_slice","createdAt":"2025-05-15T10:18:57.272Z","version":1}
{"type":"relation","relationType":"uses_function","to":"fetchLastWorkoutExerciseInstanceFromDB","from":"WorkoutExerciseContainer.tsx","createdAt":"2025-05-15T10:18:57.272Z","version":1}
{"type":"relation","relationType":"uses_column","from":"WorkoutExerciseContainer.tsx","to":"exercises.is_static","createdAt":"2025-05-15T10:18:57.272Z","version":1}
{"type":"relation","to":"workoutSlice.ts","from":"WorkoutExerciseContainer.tsx","relationType":"dispatches_to_slice","createdAt":"2025-05-15T10:18:57.272Z","version":1}
{"type":"relation","relationType":"modifies_component","to":"ExerciseSelector.tsx","from":"Timed Exercises","createdAt":"2025-05-15T10:22:29.003Z","version":1}
{"type":"relation","to":"fetchDetailedWorkoutById","from":"RecentWorkouts.tsx","relationType":"uses_function","createdAt":"2025-05-16T06:49:04.311Z","version":1}
{"type":"relation","to":"Workout Details Dialog","from":"RecentWorkouts.tsx","relationType":"implements_feature","createdAt":"2025-05-16T06:49:04.311Z","version":1}
{"type":"relation","to":"Dialog","relationType":"uses_component","from":"RecentWorkouts.tsx","createdAt":"2025-05-16T06:49:04.311Z","version":1}
{"type":"relation","from":"fetchDetailedWorkoutById","relationType":"returns_type","to":"DetailedWorkout","createdAt":"2025-05-16T06:49:04.311Z","version":1}
{"type":"relation","to":"WorkoutExerciseDetail","relationType":"contains_type","from":"DetailedWorkout","createdAt":"2025-05-16T06:49:04.311Z","version":1}
{"type":"relation","to":"WorkoutSet","from":"WorkoutExerciseDetail","relationType":"contains_type","createdAt":"2025-05-16T06:49:04.311Z","version":1}
{"type":"relation","relationType":"uses_table","to":"protein_intake","from":"Protein Logging","createdAt":"2025-05-16T08:04:43.977Z","version":1}
{"type":"relation","from":"Protein Logging","relationType":"includes_component","to":"ProteinLoggingModal","createdAt":"2025-05-16T08:04:43.977Z","version":1}
{"type":"relation","from":"Protein Logging","to":"FloatingActionButton_App.tsx","relationType":"modifies_component","createdAt":"2025-05-16T08:04:43.977Z","version":1}
{"type":"relation","relationType":"uses_file","from":"Protein Logging","to":"supabase_nutrition_client_functions","createdAt":"2025-05-16T08:04:43.977Z","version":1}
{"type":"relation","from":"ProteinLoggingModal","to":"addProteinIntake","relationType":"calls_function","createdAt":"2025-05-16T08:04:43.977Z","version":1}
{"type":"relation","from":"FloatingActionButton_App.tsx","to":"ProteinLoggingModal","relationType":"triggers_modal","createdAt":"2025-05-16T08:04:43.977Z","version":1}
{"type":"relation","relationType":"displays_data_from","from":"AnalyticsProteinProgress","to":"protein_intake","createdAt":"2025-05-16T08:04:43.977Z","version":1}
{"type":"relation","to":"ProgressBarComponent","from":"AnalyticsProteinProgress","relationType":"uses_component","createdAt":"2025-05-16T08:04:43.977Z","version":1}
{"type":"relation","from":"AnalyticsProteinProgress","relationType":"calls_function","to":"getUserWeight","createdAt":"2025-05-16T08:04:43.977Z","version":1}
{"type":"relation","from":"AnalyticsProteinProgress","to":"getDailyProteinIntake","relationType":"calls_function","createdAt":"2025-05-16T08:04:43.977Z","version":1}
{"type":"relation","relationType":"interacts_with_table","to":"protein_intake","from":"supabase_nutrition_client_functions","createdAt":"2025-05-16T08:04:43.977Z","version":1}
{"type":"relation","from":"Stratos Supabase Project","relationType":"contains_table","to":"protein_intake","createdAt":"2025-05-16T08:04:43.977Z","version":1}
{"type":"relation","to":"profiles_table","from":"Protein Logging","relationType":"uses_table_for_user_weight","createdAt":"2025-05-16T08:17:30.462Z","version":1}